<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tab URL Extractor</title>
  <link rel="stylesheet" href="popup.css">
  <style>
    /* Garantir dimensões corretas do popup */
    html, body {
      width: 400px;
      height: 600px;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- Header -->
    <header class="header">
      <h1 class="header-title">Tab URL Extractor</h1>
      <p class="header-version">v1.1.1</p>
    </header>

    <!-- Estado: Ocioso (Idle) -->
    <div id="state-idle" class="state-container">
      <div class="content-centered">
        <svg class="icon-large" xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
          <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
          <line x1="12" y1="22.08" x2="12" y2="12"></line>
        </svg>
        <p class="description">
          Clique em <strong>Analisar</strong> para extrair URLs das abas abertas.
        </p>
        <button id="analyze-btn" class="btn btn-primary">
          <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
          Analisar
        </button>
      </div>
    </div>

    <!-- Estado: Analisando (Analyzing) -->
    <div id="state-analyzing" class="state-container hidden">
      <div class="content-centered">
        <div class="spinner"></div>
        <p class="loading-text">Analisando abas...</p>
        <p class="loading-subtext">Isso pode levar alguns segundos</p>
      </div>
    </div>

    <!-- Estado: Pronto (Ready) -->
    <div id="state-ready" class="state-container hidden">
      <!-- Summary -->
      <div class="summary">
        <div class="summary-item">
          <span class="summary-label">URLs encontradas:</span>
          <span id="summary-urls" class="summary-value">0</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Matrizes:</span>
          <span id="summary-matrices" class="summary-value">0</span>
        </div>
      </div>

      <!-- Actions -->
      <div class="actions">
        <button id="export-all-btn" class="btn btn-primary">
          <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
          Extrair Todos
        </button>
        <button id="new-analysis-btn" class="btn btn-secondary">
          <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="23 4 23 10 17 10"></polyline>
            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
          </svg>
          Nova Análise
        </button>
      </div>

      <!-- Format Selector -->
      <div class="format-selector">
        <label for="export-format" class="format-label">Formato de exportação:</label>
        <select id="export-format" class="format-select">
          <option value="json">JSON (estruturado)</option>
          <option value="txt">TXT (com cabeçalhos)</option>
          <option value="txt-simple" selected>TXT (apenas URLs)</option>
        </select>
      </div>

      <!-- Matrices List -->
      <div id="matrices-container" class="matrices-container">
        <!-- Matrizes serão renderizadas aqui via JavaScript -->
      </div>
    </div>

    <!-- Estado: Erro (Error) -->
    <div id="state-error" class="state-container hidden">
      <div class="content-centered">
        <svg class="icon-large icon-error" xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        <h2 class="error-title">Erro ao analisar abas</h2>
        <p id="error-message" class="error-message">
          Ocorreu um erro inesperado.
        </p>
        <button id="retry-btn" class="btn btn-primary">
          <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="23 4 23 10 17 10"></polyline>
            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
          </svg>
          Tentar Novamente
        </button>
      </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast hidden">
      <svg class="toast-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
      <span id="toast-message" class="toast-message">Operação concluída!</span>
    </div>
  </div>

  <script src="popup.js" type="module"></script>
</body>
</html>
